//--------------------------------------------
// NAME: Anton Georgiev
// CLASS: XIa
// NUMBER: 3
// PROBLEM: #1
// FILE NAME: Anton_Georgiev.c
// FILE PURPOSE:Osnovnata programa ot domashno 1
// 
//---------------------------------------------
#include <fcntl.h>
#include <stdio.h>
#include <string.h>
#include <unistd.h>

//--------------------------------------------
// FUNCTION: error_check
// Функцията е предназначена за проверка дали подадените като аргумент файлове съществуват.
// Изписване на съобщение за грешка.
// PARAMETERS:
// int file - sluji za podavane na failoviq deskriptor na funkciqta
// char argv - sluji za podavane na imeto na faila koito se proverqva s cel negovoto izpisvane
// v saob6tenieto za gre6ka
//----------------------------------------------
int error_check(int file,char argv[])
{
	if(file==-1)
	{
		fprintf(stderr, "head: cannot open '%s' for reading : No such file or directory\n",argv);
		return 0;
	}
	else return 1;
}

//--------------------------------------------
// FUNCTION: argument_files
// Funkciqta ima za cel da izpishe 10te reda 
// ot faila ili ot stdin na ekrana
// PARAMETERS:
// int file - sluji za podavane na failoviq deskriptor na funkciqta
// списък с параметрите на функцията
//----------------------------------------------
void argument_files(int file)
{
	int i=0;//broqch koito broi redovete za6toto ni trqbvat 10 reda
	char symbol;//sluji za zapametqvane na simvol po simvol s cel izpisvane na ekrana

	//cikul koito spira ako failut svarshi ili izpi6em 10 reda
	while((i<10) && (read(file,&symbol,sizeof(char))))
	{
		if(symbol=='\n')//proverqvame dali simvolut e nov red
			i++;//i ako e: uvelichavame broqcha s 1
		printf("%c",symbol);//izpe4atvame simvola
	}
	close(file);//zatvarqme faila
}

int main(int argc,char* argv[])
{
int file,i=0,j;//ima definiran fail broqch na redove i broqch na argumenti

	if(argc>1)//ako ima argumenti vlizame v tozi if
	{
		if(argc==2)//ako argumentut e edin vlizame v tozi if
		{
			file=open(argv[1],O_RDONLY,0);//opitvame da otvorim faila ot argumenta
			if(error_check(file,argv[1])==0)//i proverqvame dali sme uspeli da otvorim faila
				return 0;//ako ne programata spira
			argument_files(file);//ako da izpisvame redovete
		}
		else//ako argumentite sa pove4e ot edin vlizame v tozi else
		{
			for(j=1;j<argc;j++)//zapochvame cikul koito obhvashta vsichki argumenti
			{
				if(*argv[j]!='-')//proverqvame dali dadeniq argument e '-' ako ne vlizame v tozi if
				{
					file=open(argv[j],O_RDONLY,0);//opitvame da otvorim faila
					if(error_check(file,argv[j])==0)//i proverqvame dali sme uspeli
						return 0;
					printf("==> %s <==\n",argv[j]);//ako da izpisvame zaglavieto na faila
					argument_files(file);//i posle parvite 10 reda
				}
				else argument_files(0);//ako argumentut e '-' vlizame v else-a i izpolzvame stdin
				i=0;//nulirame broqcha na redove za da moje da obrabotim nov fail
				printf("\n");//izkarvame nov red za po-dobur izgled
			}//zavarshvame cikula s argumentite
		}
	}
	else//ako nqma argumenti
		argument_files(0);//izvikvame stdin

	return 0;
}//programata prikluchva
